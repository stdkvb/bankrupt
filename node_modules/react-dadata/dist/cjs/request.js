"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.makeRequest = void 0;
var xhr;
var makeRequest = function (method, endpoint, data, cache, onReceiveData) {
    if (xhr) {
        xhr.abort();
    }
    var cacheKey;
    if (cache) {
        cacheKey = cache.serializeCacheKey({
            headers: data.headers,
            body: data.json,
            url: endpoint,
            method: method,
        });
        var cachedData = cache.get(cacheKey);
        if (cachedData) {
            onReceiveData(cachedData);
            return;
        }
    }
    xhr = new XMLHttpRequest();
    xhr.open(method, endpoint);
    if (data.headers) {
        Object.entries(data.headers).forEach(function (_a) {
            var header = _a[0], headerValue = _a[1];
            xhr.setRequestHeader(header, headerValue);
        });
    }
    xhr.send(JSON.stringify(data.json));
    xhr.onreadystatechange = function () {
        var _a;
        if (!xhr || xhr.readyState !== 4) {
            return;
        }
        if (xhr.status === 200) {
            var payload = (_a = JSON.parse(xhr.response)) === null || _a === void 0 ? void 0 : _a.suggestions;
            if (payload) {
                cache === null || cache === void 0 ? void 0 : cache.set(cacheKey, payload);
                onReceiveData(payload);
            }
        }
    };
};
exports.makeRequest = makeRequest;
